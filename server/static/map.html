<!--
	Todo:
		- Checkout clock for showing 24 hour? cycle
		- checkout different themes
		- solve time delay problem (see closure, or data{} in slides)
		- start writing functions for each element (mapping time, etc.)
		- download and write script
		- add info box

	General todo:
		- save SSH setup in github
		- setup couch DB
		- download charting library for local use!
		- Maybe set up node JS to serve the page locally?
		- ...

	** clean up code below (you can do concurrent attacks )

-->









<html>
	<head>
		<script src="https://www.amcharts.com/lib/3/ammap.js"></script>
		<script src="https://www.amcharts.com/lib/3/maps/js/worldLow.js"></script>
		<script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
		<link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
		<script src="https://www.amcharts.com/lib/3/themes/light.js"></script>


		<style type="text/css">
			#chartdiv {
			  width: 100%;
			  height: 600px;
			}						
		</style>

	</head>


	<body>
		<div id="chartdiv"></div>


		<script>
			/**
			 * SVG path for target icon
			 */
			var targetSVG = "M9,0C4.029,0,0,4.029,0,9s4.029,9,9,9s9-4.029,9-9S13.971,0,9,0z M9,15.93 c-3.83,0-6.93-3.1-6.93-6.93S5.17,2.07,9,2.07s6.93,3.1,6.93,6.93S12.83,15.93,9,15.93 M12.5,9c0,1.933-1.567,3.5-3.5,3.5S5.5,10.933,5.5,9S7.067,5.5,9,5.5 S12.5,7.067,12.5,9z";

			/**
			 * SVG path for plane icon
			 */
			var planeSVG = "m2,106h28l24,30h72l-44,-133h35l80,132h98c21,0 21,34 0,34l-98,0 -80,134h-35l43,-133h-71l-24,30h-28l15,-47";


			/**
			 * initialize map
			 */
			var map = AmCharts.makeChart( "chartdiv", {
			  "type": "map",
			  "theme": "light",
			  //"projection": "winkel3",
			  	"dataProvider": {
			    	"map": "worldLow",

			    "lines": [ {
			      "id": "line1",
			      "arc": -0.85,
			      "alpha": 0.3,
			      "latitudes": [0, 45.5231],
			      "longitudes": [0, -122.6765]
			    }],
			    "images": [ 
			    //city plot points, begin with target
			    {
			      "svgPath": targetSVG,
			      "title": "Portland",
			      "latitude": 45.5231,
			      "longitude": -122.6765
			    },

			    // begin plane lines?
			    {
			      "id": "plane1",
			      "svgPath": planeSVG,
			      "positionOnLine": 0,
			      "color": "#585869",
			      "animateAlongLine": true,
			      "lineId": "line1",				// this in needed for chart.validateData() to rerender the animation
			      //"flipDirection": true,
			      //"loop": false,
			      "scale": 0.02,
			      "positionScale": 1.3,
			      "listeners": [ 
				{
					"event": "animationEnd",
					"method": function(e){

						//add new image


						console.log('animationFinished called in line');
						

						//trying timeout for 
						//setTimeout(test, 1000, e);
						test(e);
					}
				},
				{
					"event": "animationStart",
					"method": function(e){

						//add new image


						console.log('animationStart called in line');
						//test(e);
					}
				}]

			    } ]
			  },

			  "areasSettings": {
			   // "unlistedAreasColor": "#FF0000"	//redish
			    "unlistedAreasColor": "#8dd9ef"		//this changes the map-color
			  },

			  "imagesSettings": {
			    "color": "#585869",
			    "rollOverColor": "#FF5869",
			    "selectedColor": "#58FF69",
			    "pauseDuration": 1, 				//control lag here.
			    "animationDuration": 2.5,
			    "adjustAnimationSpeed": true
			  },

			  "linesSettings": {
			    "color": "#585869",
			    "alpha": 0.4
			  },

			  "export": {
			    "enabled": true
			  },

			  "listeners": [ {
				    "event": "init",
				    "method": function( e ) {

				    	console.log('init handler called');
				    	test(e);
				     }
				}
				]

			});

			var global_list = [

			//see https://docs.amcharts.com/3/javascriptmaps/MapImage for image options
				{
			     "type": "circle",
			      "title": "Toronto",
			      
			      "latitude": 43.8163,
			      "longitude": -79.4287,
			      //description is on click display of indormation
			      "description": "From: Toronto, Type: SMTP",
			      "descriptionWindowHeight": 100,
			      "descriptionWindowWidth": 50
			    },
				{
			      "type": "circle",
			      "title": "Los Angeles",
			      
			      "latitude": 34.3,
			      "longitude": -118.15
			    }, {
			      "type": "circle",
			      "title": "Havana",
			      "latitude": 23,
			      "longitude": -82
			    },
			    {
			      //"width": 32,
			      //"fixedSize":false,

			      "type": "circle",
			      //"svgPath": targetSVG,
			      "title": "Shanghai",

			      "latitude": 31.2304,
			      "longitude": 121.4737,
			      "color" : "#00FF00",
			    }
			    
			    ]

		


			function test(e){
				if(global_list.length != 0){
							console.log(global_list);
							att = global_list.pop();

							line = e.chart.getObjectById("line1");
							line.latitudes[0] = att["latitude"];
							line.longitudes[0] = att["longitude"];
							//line.validate();
							//^update the line on the map.

							//testing set speed



							e.chart.dataProvider.images.push(att);
							//^add new attacker image
							
							e.chart.validateData();
							// this will redraw the entire chart

							console.log("calling animate plane...");
							
							
							//UGH this essentially does nothing. The work is all done
							// by .validateDate() which redraws the chart and subsequently 
							// renders line one
							//var plane = e.chart.getObjectById("plane1");
							//plane.animateAlong('line1');
							

							//setTimeout(animateAttack, 5000, plane, "line1");
							//after validation, this function should be triggered again
						}
			}

			function animateAttack(chartImg, line){
				console.log("in animate attack");
				chartImg.animateAlong(line);
			}


			function setSpeed(targetCoordinates, eventCoordinates){
				//each event should last about 2 seconds
				var y = targetCoordinates.latitude - eventCoordinates.latitude;
				var x = targetCoordinates.longitude - eventCoordinates.longitude;
				
				var distance = Math.sqrt(x*x + y*y);

			}
			

			


		</script>

	</body>

</html>