<html>
    <head>
        <!-- Bootstrap Core CSS -->
        <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- MetisMenu CSS 
        <link href="/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
        -->

        <!-- DataTables CSS -->
        <link href="/vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

        <!-- DataTables Responsive CSS -->
        <link href="/vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/dist/css/sb-admin-2.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

        <!-- jQuery -->
        <script src="/vendor/jquery/jquery.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="/vendor/bootstrap/js/bootstrap.min.js"></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src="/vendor/metisMenu/metisMenu.min.js"></script>


        <!-- DataTables JavaScript -->
        <script src="/vendor/datatables/js/jquery.dataTables.min.js"></script>
        <script src="/vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
        <script src="/vendor/datatables-responsive/dataTables.responsive.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/dist/js/sb-admin-2.js"></script>

        <!-- spinner -->
        <script src="/spin.js"></script>




        <!-- headers for chart.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

        <!-- local js stuff-->
        <script src="/config.js"></script> 


        <style type="text/css">
            #chartdiv {
              width: 80%;
              height: 100px;
              margin: auto;
              border-radius: 3px;
              border-style: fill;
              border-width: 2px;
              border-color: black;
            }
            #loader {
                width: 100%;
                height: 350px;
                vertical-align: middle;
                text-align: center;
            }
        </style>
    </head>
    <body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <!-- eventMap panel -->
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Login Attempts Data
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-data-toggle="dropdown">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li><a href="#">toggle map export</a>
                                    </li>
                                    <li><a href="#" onclick="toggleLiveStream()">toggle live a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div><!-- /.panel-heading -->
                    <div class="panel-body">
                        <div class="row">
                            <div class="col col-md-6">
                                <canvas id="usernameChart" class="chartdiv"></canvas>
                            </div>
                            <div class="col col-md-6">
                                <canvas id="passwordChart" class="chartdiv"></canvas>
                            </div>
                        </div>
                        <div class="row" id="loader-row">
                            <div id="loader"></div>
                        </div>
                        <div class="row" id="table-row">
                            <div class="col col-md-12">
                                 <table width="100%" class="table table-striped table-btable-hover"  id="event-table">
                                    
                                 </table>
                                
                            </div>
                       
                    </div>
                </div> <!-- /.panel -->
            </div> <!-- end col -->
        </div> <!-- end row -->
    </div><!-- end grid --> 

    <script>
        var spinner = new Spinner().spin();
        $('#loader').append(spinner.el);


        var usernameCtx = document.getElementById("usernameChart").getContext('2d');
        var usernameChart = new Chart(usernameCtx, {
            type: "doughnut",
            data: {
                labels: [],
                datasets: []
            },
            options: {
                legend: {
                    "display": true
                },
                title: {
                    display: true,
                    text: "most common usernames"
                }
            }
        });
        var passwordCtx = document.getElementById("passwordChart").getContext('2d');
        var passwordChart = new Chart(passwordCtx, {
            type: "doughnut",
            data: {
                labels: [],
                datasets: []
            },
            options: {
                legend: {
                    "display": true
                },
                title: {
                    display: true,
                    text: "most common passwords"
                }
            }
        });

        jQuery.get({
            url: '/events/chartData',
            dataType: "json",
            success: function(response, status){
              
                if(!response.error){
                    console.log(response);
                    usernameChart.data.labels = response.usernameData.labels;
                    usernameChart.data.datasets.push({
                        label: 'usernames',
                        data: response.usernameData.data,
                        backgroundColor: response.usernameData.backgroundColor,
                        borderWidth: 1
                    });
                    passwordChart.data.labels = response.usernameData.labels;
                    passwordChart.data.datasets.push({
                        label: 'passwords',
                        data: response.passwordData.data,
                        backgroundColor: response.passwordData.backgroundColor,
                        borderWidth: 1
                    });

                    passwordChart.update();
                    usernameChart.update();

                    $('#event-table').DataTable({
                        data: response.tableRows,
                        columns: [
                            {data: 'username', title: 'username'},
                            {data: 'password', title: 'password'},
                            {data: 'count', title: 'count'}
                        ],
                        order: [[2, 'desc']],
                        //on render, remove the loader icon and display the table
                        "initComplete": function(settings, json) {
                            $('#loader-row').remove();
                            $('#table-row').css({
                                'visibility': 'visible'
                            });
                            
                        },
                        responsive: true
                    });
                }
            }
        });

    </script>


    </body>
</html>




